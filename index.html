<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VSB Timetable Picker</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            background-color: #242424;
            color: rgba(255, 255, 255, 0.87);
            font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
            overflow-y: scroll;
        }
        
        #root {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem;
            text-align: center;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #333; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #777; }

        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- DEMO DATA ---
        const DEMO_DATA = [
            {
                title: "DEMO_Předmět",
                data: {
                    subjectScheduleTable: {
                        days: [
                            { title: "Pondělí", queues: [] },
                            { title: "Úterý", queues: [
                                { items: [
                                    { used: true, duration: 2, dto: { scheduleWindowBeginTime: "09:00", scheduleWindowEndTime: "10:30", teacherShortNamesString: "Demo Učitel", subjectAbbrev: "DEMO", lecture: true, concreteActivityId: 123 } },
                                    { used: true, duration: 2, dto: { scheduleWindowBeginTime: "10:45", scheduleWindowEndTime: "12:15", teacherShortNamesString: "Demo Cvičící", subjectAbbrev: "DEMO", lecture: false, concreteActivityId: 124 } },
                                    { used: true, duration: 2, dto: { scheduleWindowBeginTime: "09:00", scheduleWindowEndTime: "10:30", teacherShortNamesString: "Kolize", subjectAbbrev: "DEMO", lecture: false, concreteActivityId: 125 } }
                                ]}
                            ]},
                            { title: "Středa", queues: [] },
                            { title: "Čtvrtek", queues: [] },
                            { title: "Pátek", queues: [] }
                        ]
                    }
                }
            }
        ];

        // --- Helper funkce ---
        async function copyPickScript(scriptContent) {
            try {
                await navigator.clipboard.writeText(scriptContent);
                return true;
            } catch (err) {
                const textArea = document.createElement('textarea');
                textArea.value = scriptContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                return true;
            }
        }

        const Modal = ({ isOpen, onClose, children, title }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center modal-overlay p-4" onClick={onClose}>
                    <div className="bg-gray-800 rounded-lg shadow-xl border border-gray-700 w-full max-w-lg p-6 relative" onClick={e => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-white">
                            <i className="fas fa-times text-xl"></i>
                        </button>
                        <h2 className="text-2xl font-bold mb-4 text-white">{title}</h2>
                        {children}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [timetableData, setTimetableData] = useState(() => {
                const saved = localStorage.getItem("vsb_timetable_data");
                if (saved) {
                    try { return JSON.parse(saved); } catch (e) { return DEMO_DATA; }
                }
                return DEMO_DATA;
            });

            const [selectedEntries, setSelectedEntries] = useState(() => {
                const savedEntries = localStorage.getItem("selectedEntries");
                return new Set(savedEntries ? JSON.parse(savedEntries) : []);
            });
            const [selectedSubjects, setSelectedSubjects] = useState(() => {
                const savedSubjects = localStorage.getItem("selectedSubjects");
                return new Set(savedSubjects ? JSON.parse(savedSubjects) : []);
            });

            const [showUnusedClasses, setShowUnusedClasses] = useState(
                localStorage.getItem("showUnusedClasses") === "true"
            );

            const [isUploadModalOpen, setIsUploadModalOpen] = useState(false);

	    const [tooltip, setTooltip] = useState(null);

            useEffect(() => {
                localStorage.setItem("vsb_timetable_data", JSON.stringify(timetableData));
            }, [timetableData]);

            const timeSlots = [
                "07:15-08:00", "08:00-08:45", "09:00-09:45", "09:45-10:30", "10:45-11:30",
                "11:30-12:15", "12:30-13:15", "13:15-14:00", "14:15-15:00", "15:00-15:45",
                "16:00-16:45", "16:45-17:30", "17:45-18:30", "18:30-19:15",
            ];

            const colors = ["bg-green-700", "bg-fuchsia-500", "bg-orange-500", "bg-yellow-500", "bg-purple-700", "bg-pink-900", "bg-indigo-500", "bg-violet-900"];
            const subjectColors = {}; 

const getCurrentTimePosition = () => {
    const now = new Date();
    const currentMinutes = now.getHours() * 60 + now.getMinutes();
    const TIME_SLOT_WIDTH = 74;

    for (let i = 0; i < timeSlots.length; i++) {
        const [start, end] = timeSlots[i].split("-").map((t) => {
            const [h, m] = t.split(":").map(Number);
            return h * 60 + m;
        });

        if (currentMinutes < start) {
   if (i === 0) {
                return 1;
            }
            return i * TIME_SLOT_WIDTH;
        }

        if (currentMinutes >= start && currentMinutes < end) {
            const slotProgress = (currentMinutes - start) / (end - start);
            const position = i * TIME_SLOT_WIDTH + slotProgress * TIME_SLOT_WIDTH;
            return position === 0 ? 1 : position;
        }

    }

    return timeSlots.length * TIME_SLOT_WIDTH;
};

            const [currentTimePosition, setCurrentTimePosition] = useState(getCurrentTimePosition());
            
            useEffect(() => {
                const interval = setInterval(() => {
                    setCurrentTimePosition(getCurrentTimePosition());
                }, 60000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                localStorage.setItem("selectedEntries", JSON.stringify(Array.from(selectedEntries)));
            }, [selectedEntries]);

            useEffect(() => {
                localStorage.setItem("selectedSubjects", JSON.stringify(Array.from(selectedSubjects)));
            }, [selectedSubjects]);

            // Handlery
            const handleFileUpload = (event) => {
                const files = Array.from(event.target.files);
                if (files.length === 0) return;
                const promises = files.map(file => {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const json = JSON.parse(e.target.result);
                                const title = file.name.replace(".json", "");
                                resolve({ title, data: json.default || json });
                            } catch (err) { resolve(null); }
                        };
                        reader.readAsText(file);
                    });
                });
                Promise.all(promises).then(results => {
                    const validData = results.filter(item => item !== null);
                    setTimetableData(prev => {
                        const existingTitles = new Set(prev.map(p => p.title));
                        const newData = validData.filter(d => !existingTitles.has(d.title));
                        return [...prev, ...newData];
                    });
                    setIsUploadModalOpen(false);
                });
            };

            const handleDeleteAll = () => {
                if(confirm("Opravdu smazat všechny nahrané rozvrhy?")) {
                    setTimetableData([]);
                    setSelectedEntries(new Set());
                    setSelectedSubjects(new Set());
                    localStorage.removeItem("vsb_timetable_data");
                    setIsUploadModalOpen(false);
                }
            };

            const handleDeleteSubject = (e, subjectName) => {
                e.stopPropagation();
                if(confirm(`Smazat předmět ${subjectName} a jeho data?`)) {
                    setTimetableData(prev => prev.filter(fileItem => {
                             const containsSubject = fileItem.title.includes(subjectName) || 
                                                     (fileItem.data?.subjectScheduleTable?.days || []).some(d => 
                                                         d.queues.some(q => q.items.some(it => it.dto?.subjectAbbrev === subjectName))
                                                     );
                             return !containsSubject;
                    }));
                    setSelectedSubjects(prev => {
                        const newSet = new Set(prev);
                        newSet.delete(subjectName);
                        return newSet;
                    });
                }
            }

            // --- VÝPOČET KONCE HODINY ---
            const calculateEndTime = (startTime, duration) => {

		startTime = startTime.substring(0, 5);
                // Najdeme index, kde začíná hodina (např. "09:00" -> index 2)
                const startIndex = timeSlots.findIndex(slot => slot.startsWith(startTime));
                
                if (startIndex === -1) return "??:-1"; // Fallback pokud čas nesedí

                // Spočítáme index konce
                // Pokud začínáme na indexu 2 a trváme 2 hodiny, chceme sloty 2 a 3.
                // Konec je konec slotu 3.
                const endIndex = startIndex + duration - 1;

                if (endIndex < timeSlots.length) {
                    return timeSlots[endIndex].split("-")[1]; // Vrátí část za pomlčkou
                }
                
                // Fallback pro nestandardní časy
                return "??:??";
            };

            // Data Processing
            const formatSchedule = (scheduleTable) => {
                const formatted = [];
                if(!scheduleTable || !scheduleTable.days) return [];
                scheduleTable.days.forEach((day) => {
                    day.queues.forEach((queue) => {
                        queue.items.forEach((item) => {
                            if (item.used && item.dto) {
                                const duration = item.duration || 2;
                                formatted.push({
                                    day: day.title,
                                    startTime: item.dto.scheduleWindowBeginTime,
                                    // ZDE JE ZMĚNA: Počítáme konec dynamicky
                                    endTime: calculateEndTime(item.dto.scheduleWindowBeginTime, duration),
                                    teacher: item.dto.teacherShortNamesString,
                                    teacherFull: item.dto.teacherFullNamesString,
                                    abbreviation: item.dto.subjectAbbrev,
                                    isLecture: item.dto.lecture,
                                    duration: duration,
                                    activityId: item.dto.concreteActivityId
                                });
                            }
                        });
                    });
                });
                return formatted;
            };

            const allEntries = timetableData.map(({ data }) => formatSchedule(data.subjectScheduleTable)).flat();

            let pomI = 0;
            allEntries.forEach((entry) => {
                if (!subjectColors[entry.abbreviation]) {
                    subjectColors[entry.abbreviation] = colors[pomI % colors.length];
                    pomI++;
                }
            });

            // Tetris Layout Logic
            const calculateLayout = (entries) => {
                const sorted = [...entries].sort((a, b) => {
                    if (a.startTime !== b.startTime) return a.startTime.localeCompare(b.startTime);
                    return b.duration - a.duration;
                });

                const rows = []; 

                const positioned = sorted.map(entry => {
                    let rowIndex = -1;
                    for(let r = 0; r < rows.length; r++) {
                        if (entry.startTime >= rows[r]) {
                            rowIndex = r;
                            rows[r] = entry.endTime; 
                            break;
                        }
                    }
                    if (rowIndex === -1) {
                        rowIndex = rows.length;
                        rows.push(entry.endTime);
                    }
                    return { ...entry, visualRowIndex: rowIndex };
                });

                return { 
                    items: positioned, 
                    rowCount: Math.max(1, rows.length)
                };
            };

            const pickClass = (entry) => {
                setSelectedEntries((prev) => {
                    const newSet = new Set(prev);
                    const key = `${entry.day}~${entry.startTime}~${entry.abbreviation}~${entry.isLecture}~${entry.teacher}`;
                    if (newSet.has(key)) newSet.delete(key);
                    else newSet.add(key);
                    return newSet;
                });
            };

            const toggleSubject = (subject) => {
                setSelectedSubjects((prev) => {
                    const newSet = new Set(prev);
                    if (newSet.has(subject)) newSet.delete(subject);
                    else newSet.add(subject);
                    return newSet;
                });
            };

            const groupAndFilterEntries = () => {
                const grouped = { Pondělí: [], Úterý: [], Středa: [], Čtvrtek: [], Pátek: [] };
                
                allEntries.forEach((entry) => {
                    const key = `${entry.day}~${entry.startTime}~${entry.abbreviation}~${entry.isLecture}~${entry.teacher}`;
                    const isSelected = selectedEntries.has(key);
                    const isSubjectVisible = selectedSubjects.size === 0 || selectedSubjects.has(entry.abbreviation);
                    const isCollisionVisible = showUnusedClasses || !isEntryHidden(entry);
                    
                    if ((isSubjectVisible && isCollisionVisible) || isSelected) {
                        if(grouped[entry.day]) grouped[entry.day].push(entry);
                    }
                });
                return grouped;
            }

            const uniqueSubjects = [...new Set(allEntries.map((entry) => `${entry.abbreviation}~${entry.isLecture ? "P" : "C"}`))];
            const subjectTypesMap = uniqueSubjects.reduce((acc, subject) => {
                const [name, type] = subject.split("~");
                if (!acc[name]) acc[name] = [];
                acc[name].push(type);
                return acc;
            }, {});

            const isEntryHidden = (entry) => {
                for (const selectedEntryKey of selectedEntries) {
                    const selectedEntry = allEntries.find(e => `${e.day}~${e.startTime}~${e.abbreviation}~${e.isLecture}~${e.teacher}` === selectedEntryKey);
                    if (selectedEntry) {
                        if (entry.abbreviation === selectedEntry.abbreviation && entry.isLecture === selectedEntry.isLecture && entry !== selectedEntry) return true;
                        if (entry.startTime === selectedEntry.startTime && entry.day === selectedEntry.day && entry !== selectedEntry) return true;
                    }
                }
                return false;
            };

            const getTimeSlotIndex = (time) => {
                return timeSlots.findIndex(slot => slot.startsWith(time)) + 2;
            }

            const generatePickScript = () => {
                const subjects_array = {};
                const subject_map = [];
                const selectedData = Array.from(selectedEntries).map(key => allEntries.find(entry => `${entry.day}~${entry.startTime}~${entry.abbreviation}~${entry.isLecture}~${entry.teacher}` === key)).filter(Boolean);

                selectedData.forEach(entry => {
                    const matchingFile = timetableData.find(item => item.title.includes(entry.abbreviation));
                    if (matchingFile) {
                        const subjectId = matchingFile.title.split('__')[0];
                        const concreteActivityId = entry.activityId.toString();
                        if (!subjects_array[subjectId]) { subjects_array[subjectId] = []; subject_map.push(subjectId); }
                        if (!subjects_array[subjectId].includes(concreteActivityId)) subjects_array[subjectId].push(concreteActivityId);
                    }
                });

                return `(function(){let c=0;const e=new Event('readyToClick');var s=$('#ns_Z7_SHD09B1A084V90ITII3I3Q30P7_\\\\:subjectsTable a');var a=${JSON.stringify(subjects_array)};var m=${JSON.stringify(subject_map)};function sc(id){for(var i=0;i<s.length;i++){if(s[i].attributes.onclick.nodeValue.includes(id)){s[i].click();console.log('S:',id)}}}function tc(id){var t=$('#ns_Z7_SHD09B1A084V90ITII3I3Q30P7_\\\\:subjectScheduleDiv a');for(var i=0;i<t.length;i++){if(t[i].attributes.onclick.nodeValue.includes(id)){t[i].click();console.log('T:',id)}}}function w(sel){return new Promise(r=>{if(document.querySelector(sel))return r(document.querySelector(sel));const o=new MutationObserver(()=>{if(document.querySelector(sel)){r(document.querySelector(sel));o.disconnect()}});o.observe(document.body,{childList:true,subtree:true})})}document.body.addEventListener('readyToClick',()=>{setTimeout(()=>{sc(m[c]);w("a[onclick*='"+a[m[c]][0]+"']").then(()=>{setTimeout(()=>{tc(a[m[c]][0]);c++;if(c<m.length)document.body.dispatchEvent(e)},150)})},150)},false);document.body.dispatchEvent(e)}());`;
            }

            const handleCopyPickScript = async () => {
                const script = generatePickScript();
                const ok = await copyPickScript(script);
                if (ok) alert('Skript zkopírován!');
            };

            const toggleUnusedClasses = () => {
                const newVal = !showUnusedClasses;
                setShowUnusedClasses(newVal);
                localStorage.setItem("showUnusedClasses", newVal);
            }

            const groupedData = groupAndFilterEntries();
            const DAY_COL_WIDTH = 70;
            const SLOT_WIDTH = 74;
            const ROW_HEIGHT = 60;
            const TABLE_WIDTH = DAY_COL_WIDTH + (timeSlots.length * SLOT_WIDTH);

            return (
                <div className="flex-1 container mx-auto p-4 flex flex-col items-center">
                    
                    <div className="absolute top-4 right-4">
                        <button onClick={() => setIsUploadModalOpen(true)} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded shadow flex items-center gap-2">
                            <i className="fas fa-cog"></i> Správa rozvrhů
                        </button>
                    </div>

                    <Modal isOpen={isUploadModalOpen} onClose={() => setIsUploadModalOpen(false)} title="Správa rozvrhů">
                        <div className="flex flex-col gap-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-300 mb-2">Nahrát nové soubory (.json)</label>
                                <input type="file" multiple accept=".json" onChange={handleFileUpload} className="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:bg-blue-600 file:text-white hover:file:bg-blue-700 cursor-pointer"/>
                            </div>
                            <div className="border-t border-gray-600 pt-4">
                                <button onClick={handleDeleteAll} className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded flex items-center justify-center gap-2">
                                    <i className="fas fa-trash"></i> Smazat vše a resetovat
                                </button>
                            </div>
                        </div>
                    </Modal>

                    <div className="mb-4 w-[1106px] flex justify-between items-center mt-12">
                        <h2 className="text-xl font-bold text-white">2. Vyberte si cvičení</h2>
                        <div className="flex gap-4">
                            <label className="inline-flex items-center cursor-pointer bg-gray-800 px-3 py-2 rounded border border-gray-700 hover:bg-gray-700 transition">
                                <input type="checkbox" onChange={toggleUnusedClasses} checked={showUnusedClasses} className="sr-only peer"/>
                                <div className="relative w-9 h-5 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-green-600 after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all"></div>
                                <span className="ml-3 text-sm font-medium text-gray-300">Všechny varianty</span>
                            </label>
                            <button onClick={handleCopyPickScript} className="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded shadow">
                                <i className="fas fa-copy mr-2"></i> Zkopírovat Skript
                            </button>
                        </div>
                    </div>

                    <div className="flex flex-wrap gap-3 mb-6 w-[1106px] justify-center">
                        {Object.entries(subjectTypesMap).map(([name, types]) => (
                        <div key={name} className="relative group">
                            <button onClick={() => toggleSubject(name)} className={`px-4 py-3 border rounded-lg transition-all duration-200 shadow-lg ${selectedSubjects.has(name) ? "bg-gray-700 border-gray-500" : "bg-zinc-800 border-zinc-600 opacity-60 hover:opacity-100"}`}>
                                <div className={`font-bold ${subjectColors[name]} text-white rounded mb-2 py-1 px-3 text-lg shadow-sm`}>{name}</div>
                                <div className="flex justify-center gap-2 w-full">
                                {types.map((type,i) => {
                                    const isSelected = Array.from(selectedEntries).some((el) => {
                                        const split = el.split("~");
                                        return split[2] === name && split[3] === (type === "C" ? "false" : "true");
                                    });
                                    return <div key={name+type+i} className={`inline-block px-2 py-0.5 text-xs rounded font-bold border ${type === "C" ? (isSelected ? "bg-blue-600 border-blue-400 text-white" : "text-blue-400 border-blue-900") : (isSelected ? "bg-red-600 border-red-400 text-white" : "text-red-400 border-red-900")}`}>{type}</div>
                                })}
                                </div>
                            </button>
                            <button onClick={(e) => handleDeleteSubject(e, name)} className="absolute -top-2 -right-2 bg-red-600 hover:bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        ))}
                    </div>

                    <div className="flex-col mb-1 select-none">
                        <div className="flex bg-gray-800 border-b-2 border-gray-600" style={{width: TABLE_WIDTH}}>
                            <div className="flex-none bg-gray-700 flex items-center justify-center font-bold text-gray-400 border-r border-gray-600" style={{width: DAY_COL_WIDTH}}>Den</div>
                            {timeSlots.map((slot, index) => (
                                <div key={slot} className={`flex-none h-full py-2 text-center text-xs text-gray-400 border-r border-gray-700/50 flex flex-col justify-center ${index % 2 ? "bg-gray-700/30" : "bg-gray-800"}`} style={{width: SLOT_WIDTH}}>
                                    {slot.split("-").map((part, i) => <div key={i}>{part}</div>)}
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="relative flex flex-col gap-1 pb-20 select-none">
                        {currentTimePosition && (
                            <div className="absolute h-full w-0.5 bg-red-500 z-20 pointer-events-none shadow-[0_0_8px_rgba(239,68,68,0.8)]" style={{ left: `${currentTimePosition + DAY_COL_WIDTH}px` }}/>
                        )}
                        
                        {["Pondělí", "Úterý", "Středa", "Čtvrtek", "Pátek"].map((day) => {
                            const rawEntries = groupedData[day] || [];
                            const { items: positionedEntries, rowCount } = calculateLayout(rawEntries);

                            return (
                                <div key={day} className="relative bg-gray-800 border-b border-gray-700 grid" 
                                     style={{ 
                                         width: TABLE_WIDTH,
                                         gridTemplateColumns: `${DAY_COL_WIDTH}px repeat(${timeSlots.length}, ${SLOT_WIDTH}px)`,
                                         gridTemplateRows: `repeat(${rowCount}, ${ROW_HEIGHT}px)` 
                                     }}>
                                    
                                    <div className="col-start-1 flex items-center justify-center bg-sky-900 text-sky-200 font-bold text-lg border-r border-gray-600 z-10"
                                         style={{ gridRow: `1 / span ${rowCount}` }}>
                                        {day.substring(0, 2)}
                                    </div>

                                    <div className="absolute inset-0 pointer-events-none z-0">
                                        {timeSlots.map((_, i) => (
                                            <div key={i} className="absolute top-0 bottom-0 border-r border-gray-700/40" style={{ left: DAY_COL_WIDTH + ((i+1) * SLOT_WIDTH) }}></div>
                                        ))}
                                    </div>

                                    {positionedEntries.map((subject, index) => {
                                        const key = `${subject.day}~${subject.startTime}~${subject.abbreviation}~${subject.isLecture}~${subject.teacher}`;
                                        const isSelected = selectedEntries.has(key);
                                        const colStart = getTimeSlotIndex(subject.startTime.substring(0,5));

                                        return (
                                            <div
                                                key={index}
                                                className={`
                                                    relative z-10 m-[2px] border-2 rounded-md cursor-pointer overflow-hidden text-xs
                                                    transition-all duration-150 hover:z-20 hover:shadow-xl hover:scale-105
                                                    ${showUnusedClasses && "select-none"} 
                                                    ${subject.isLecture ? "border-red-800 bg-red-900/80 hover:bg-red-800" : "border-sky-800 bg-sky-900/80 hover:bg-sky-800"} 
                                                    ${isSelected ? `!border-lime-400 ring-1 ring-lime-400 !bg-opacity-100 shadow-md` : ""} 
                                                    ${isEntryHidden(subject) && !isSelected ? "opacity-30 grayscale" : ""}
                                                    ${isSelected && subject.isLecture ? "!bg-red-700" : ""} 
                                                    ${isSelected && !subject.isLecture ? "!bg-sky-700" : ""}
                                                `}
                                                style={{
                                                    gridColumnStart: colStart,
                                                    gridColumnEnd: colStart + subject.duration,
                                                    gridRow: subject.visualRowIndex + 1
                                                }}

onClick={() => {
    if (!isEntryHidden(subject)) {
      pickClass(subject);
    }
  }}

onContextMenu={(e) => {
    e.preventDefault();
    setTooltip({
      x: e.clientX,
      y: e.clientY,
      text: subject.teacher
    });
  }}



                                            >
                                                <div className="px-2 py flex flex-col h-full justify-between">
<input
      type="checkbox"
      className="hidden"
      checked={isSelected}
      readOnly // Přidáno, aby React nekřičel, že input nemá onChange
      disabled={isEntryHidden(subject)}
    />                                                    <div className="flex justify-between items-start">
                                                        <span className={`font-bold px-1.5 py-0.5 rounded text-[10px] text-white ${selectedSubjects.has(subject.abbreviation) ? "bg-red-500" : subjectColors[subject.abbreviation]}`}>
                                                            {subject.abbreviation}
                                                        </span>
                                                        <span className="font-mono opacity-70">{subject.isLecture ? "P" : "C"}</span>
                                                    </div>
                                                    <div className="font-semibold truncate" title={subject.teacher}>{subject.teacher}</div>
                                                    <div></div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            );
                        })}
                    </div>
                    {tooltip && (
    <div style={{
        position: 'fixed',
        top: tooltip.y + 15, // Trochu posuneme pod kurzor
        left: tooltip.x + 15,
        backgroundColor: '#1f2937', // Tmavě šedá (ladí s designem)
        border: '1px solid #4b5563',
        padding: '12px',
        borderRadius: '8px',
        zIndex: 100, // Aby bylo nad vším ostatním
        boxShadow: '0 4px 6px rgba(0,0,0,0.5)',
        color: 'white',
        maxWidth: '300px',
        pointerEvents: 'auto' // Aby šlo kliknout na zavírací křížek
    }}>
        <div className="font-bold text-xs text-gray-400 mb-1 uppercase tracking-wider">Vyučující</div>
        <div className="text-sm font-medium">{tooltip.text}</div>
        
        {/* Tlačítko pro zavření */}
        <button
            onClick={(e) => {
                e.stopPropagation(); // Aby se neprokliklo nic pod tím
                setTooltip(null);
            }}
            className="absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md transition-colors"
        >
            <i className="fas fa-times text-xs"></i>
        </button>
    </div>
)}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
